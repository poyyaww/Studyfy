<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ðŸ“š Studyfy - Local Professional</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* --- 3D Flip Card Styles --- */
    .flip-card { perspective: 1000px; }
    .flip-card-inner { transition: transform 0.6s; transform-style: preserve-3d; }
    .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
    .flip-card-front, .flip-card-back { backface-visibility: hidden; position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
    .flip-card-back { transform: rotateY(180deg); }
    @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    .animate-slide-down { animation: slideDown 0.3s ease-out; }
    .professional-bg { background-color: #0f172a; background-image: radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%); position: relative; overflow: hidden; }
    .professional-bg::before { content: ""; position: absolute; width: 120%; height: 120%; top: -10%; left: -10%; background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"); }
    .action-btn-front { transform: translateZ(30px); z-index: 20; }
    .custom-scroll::-webkit-scrollbar { width: 6px; }
    .custom-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
    .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo, useCallback } = React;

    // --- ICONS ---
    const Calendar = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>;
    const Clock = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
    const Award = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>;
    const TrendingUp = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>;
    const Book = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>;
    const Brain = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 2a9 9 0 0 0-9 9c0 3 1.5 5.5 4 7 1 .5 2 1 2 2v2h6v-2c0-1 1-1.5 2-2 2.5-1.5 4-4 4-7a9 9 0 0 0-9-9z"/></svg>;
    const Timer = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="13" r="8"/><path d="M12 9v4l2 2"/><path d="M9 2h6"/></svg>;
    const Zap = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>;
    const Plus = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
    const X = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>;
    const Check = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>;
    const Play = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"/></svg>;
    const Pause = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>;
    const BarChart3 = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>;
    const Trash = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>;
    const Filter = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>;
    const Info = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>;
    const ListTodo = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>;
    const Edit = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>;

    // --- ISOLATED COMPONENTS ---
    const Modal = ({ title, children, onClose }) => (
      <div className="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <div className="bg-white rounded-xl p-6 max-w-md w-full animate-slide-down shadow-2xl border border-gray-100">
          <div className="flex justify-between items-center mb-4 border-b pb-2">
            <h3 className="text-xl font-bold text-gray-800">{title}</h3>
            <button onClick={onClose} className="text-gray-400 hover:text-gray-600 transition-colors p-1 rounded-full hover:bg-gray-100"><X /></button>
          </div>
          <div className="space-y-4">{children}</div>
        </div>
      </div>
    );

    const ConfirmationModal = ({ isOpen, message, onConfirm, onCancel, confirmLabel = "Hapus", confirmColor = "bg-red-500 hover:bg-red-600" }) => {
      if (!isOpen) return null;
      return (
        <div className="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-[60] p-4">
          <div className="bg-white rounded-xl p-6 max-w-sm w-full animate-slide-down shadow-2xl">
            <div className={`flex items-center justify-center mb-4 ${confirmLabel === 'Keluar' ? 'text-blue-500' : 'text-red-500'}`}>
              <svg className="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
            </div>
            <h3 className="text-lg font-bold text-center text-gray-800 mb-2">Konfirmasi</h3>
            <p className="text-gray-600 text-center mb-6">{message}</p>
            <div className="flex gap-3">
              <button onClick={onCancel} className="flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 font-semibold transition-colors">Batal</button>
              <button onClick={onConfirm} className={`flex-1 px-4 py-2 text-white rounded-lg font-semibold transition-colors shadow-lg ${confirmColor}`}>{confirmLabel}</button>
            </div>
          </div>
        </div>
      );
    };

    const NotificationModal = ({ isOpen, message, onClose }) => {
      if (!isOpen) return null;
      return (
        <div className="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-[70] p-4">
          <div className="bg-white rounded-xl p-6 max-w-sm w-full animate-slide-down shadow-2xl">
            <div className="flex items-center justify-center text-blue-500 mb-4"><Info /></div>
            <p className="text-gray-600 text-center mb-6">{message}</p>
            <button onClick={onClose} className="w-full px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-semibold transition-colors">OK</button>
          </div>
        </div>
      );
    };

    const TodoInput = ({ onAdd, notify }) => {
      const [text, setText] = useState('');
      const [date, setDate] = useState('');
      const handleAdd = () => {
        if (!text.trim()) { notify('Tulis nama tugasnya dulu ya!'); return; }
        onAdd(text, date); setText(''); setDate('');
      };
      return (
        <div className="flex flex-col gap-2 mb-4 bg-gray-50 p-3 rounded-xl border border-gray-100">
          <input type="text" value={text} onChange={(e) => setText(e.target.value)} placeholder="Tugas baru... (Ketik disini)" className="w-full bg-white border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" />
          <div className="flex gap-2">
            <input type="date" value={date} onChange={(e) => setDate(e.target.value)} className="w-1/2 bg-white border border-gray-200 rounded-lg px-3 py-2 text-sm text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" />
            <button onClick={handleAdd} className="w-1/2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold rounded-lg transition-colors">+ Tambah</button>
          </div>
        </div>
      );
    };

    // --- EDIT & ADD FORMS (REUSABLE) ---
    // 1. EDIT SCHEDULE MODAL
    const EditScheduleModal = ({ onClose, onSave, scheduleData, subjects }) => {
      const [form, setForm] = useState({ ...scheduleData });
      const handleSubmit = () => { onSave(form); };
      return (
        <Modal title="Edit Jadwal" onClose={onClose}>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Hari</label><select value={form.day} onChange={(e) => setForm({...form, day: e.target.value})} className="w-full border p-2 rounded-lg">{['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'].map(d => <option key={d} value={d}>{d}</option>)}</select></div>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Waktu</label><input type="time" value={form.time} onChange={(e) => setForm({...form, time: e.target.value})} className="w-full border p-2 rounded-lg" /></div>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Mapel</label><input list="subjects-list-edit" type="text" value={form.subject} onChange={(e)=>setForm({...form, subject: e.target.value})} className="w-full border p-2 rounded-lg" /><datalist id="subjects-list-edit">{subjects.map(s => <option key={s.id} value={s.name} />)}</datalist></div>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Durasi</label><input type="text" value={form.duration} onChange={(e) => setForm({...form, duration: e.target.value})} className="w-full border p-2 rounded-lg" /></div>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Tipe</label><select value={form.type} onChange={(e) => setForm({...form, type: e.target.value})} className="w-full border p-2 rounded-lg"><option value="study">Belajar</option><option value="exam">Ujian</option></select></div>
          <button onClick={handleSubmit} className="w-full bg-yellow-600 hover:bg-yellow-700 text-white p-3 rounded-lg font-bold transition-colors">Update Jadwal</button>
        </Modal>
      );
    };

    // 2. EDIT FLASHCARD MODAL
    const EditFlashcardModal = ({ onClose, onSave, cardData, subjects }) => {
      const [form, setForm] = useState({ ...cardData });
      const handleSubmit = () => { onSave(form); };
      return (
        <Modal title="Edit Flashcard" onClose={onClose}>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Mapel</label><input list="subjects-list-edit-flash" type="text" value={form.subject} onChange={(e) => setForm({...form, subject: e.target.value})} className="w-full border p-2 rounded-lg" /><datalist id="subjects-list-edit-flash">{subjects.map(s => <option key={s.id} value={s.name} />)}</datalist></div>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Pertanyaan</label><textarea rows="2" value={form.front} onChange={(e) => setForm({...form, front: e.target.value})} className="w-full border p-2 rounded-lg" /></div>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Jawaban</label><textarea rows="2" value={form.back} onChange={(e) => setForm({...form, back: e.target.value})} className="w-full border p-2 rounded-lg" /></div>
          <button onClick={handleSubmit} className="w-full bg-yellow-600 hover:bg-yellow-700 text-white p-3 rounded-lg font-bold transition-colors">Update Flashcard</button>
        </Modal>
      );
    };

    // 3. EDIT TODO MODAL
    const EditTodoModal = ({ onClose, onSave, todoData }) => {
      const [form, setForm] = useState({ ...todoData });
      const handleSubmit = () => { onSave(form); };
      return (
        <Modal title="Edit Tugas" onClose={onClose}>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Tugas</label><input type="text" value={form.text} onChange={(e) => setForm({...form, text: e.target.value})} className="w-full border p-2 rounded-lg" /></div>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Deadline</label><input type="date" value={form.deadline} onChange={(e) => setForm({...form, deadline: e.target.value})} className="w-full border p-2 rounded-lg" /></div>
          <button onClick={handleSubmit} className="w-full bg-yellow-600 hover:bg-yellow-700 text-white p-3 rounded-lg font-bold transition-colors">Update Tugas</button>
        </Modal>
      );
    };

    // --- Modal Forms (Add) ---
    const AddScheduleModal = ({ onClose, onSave, subjects, notify }) => {
      const [form, setForm] = useState({ day: 'Senin', time: '08:00', subject: '', duration: '', type: 'study' });
      const handleSubmit = () => { if (!form.subject || !form.duration) { notify('Harap isi mata pelajaran dan durasi!'); return; } onSave(form); };
      return (
        <Modal title="Tambah Jadwal Baru" onClose={onClose}>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Hari</label><select value={form.day} onChange={(e) => setForm({...form, day: e.target.value})} className="w-full border border-gray-300 p-2 rounded-lg">{['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'].map(d => <option key={d} value={d}>{d}</option>)}</select></div>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Waktu</label><input type="time" value={form.time} onChange={(e) => setForm({...form, time: e.target.value})} className="w-full border border-gray-300 p-2 rounded-lg" /></div>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Mapel</label><input list="subjects-list" type="text" value={form.subject} onChange={(e)=>setForm({...form, subject: e.target.value})} className="w-full border border-gray-300 p-2 rounded-lg" placeholder="Ketik atau pilih..." /><datalist id="subjects-list">{subjects.map(s => <option key={s.id} value={s.name} />)}</datalist></div>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Durasi</label><input type="text" value={form.duration} onChange={(e) => setForm({...form, duration: e.target.value})} className="w-full border border-gray-300 p-2 rounded-lg" placeholder="Contoh: 1 jam" /></div>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Tipe</label><select value={form.type} onChange={(e) => setForm({...form, type: e.target.value})} className="w-full border border-gray-300 p-2 rounded-lg"><option value="study">Belajar</option><option value="exam">Ujian</option></select></div>
          <button onClick={handleSubmit} className="w-full bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg font-bold transition-colors">Simpan Jadwal</button>
        </Modal>
      );
    };

    const AddFlashcardModal = ({ onClose, onSave, subjects, notify }) => {
      const [form, setForm] = useState({ subject: '', front: '', back: '' });
      const handleSubmit = () => { if (!form.subject || !form.front || !form.back) { notify('Harap isi semua field!'); return; } onSave(form); };
      return (
        <Modal title="Tambah Flashcard" onClose={onClose}>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Mapel</label><input list="subjects-list-flash" type="text" value={form.subject} onChange={(e) => setForm({...form, subject: e.target.value})} className="w-full border border-gray-300 p-2 rounded-lg" placeholder="Pilih mapel..." /><datalist id="subjects-list-flash">{subjects.map(s => <option key={s.id} value={s.name} />)}</datalist></div>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Pertanyaan</label><textarea rows="2" value={form.front} onChange={(e) => setForm({...form, front: e.target.value})} className="w-full border border-gray-300 p-2 rounded-lg" /></div>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Jawaban</label><textarea rows="2" value={form.back} onChange={(e) => setForm({...form, back: e.target.value})} className="w-full border border-gray-300 p-2 rounded-lg" /></div>
          <button onClick={handleSubmit} className="w-full bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg font-bold transition-colors">Simpan Flashcard</button>
        </Modal>
      );
    };

    const AddSubjectModal = ({ onClose, onSave, notify }) => {
      const [form, setForm] = useState({ name: '', color: 'bg-blue-500', target: 60 });
      const handleSubmit = () => { if (!form.name) { notify('Nama mata pelajaran harus diisi!'); return; } onSave(form); };
      return (
        <Modal title="Tambah Mata Pelajaran" onClose={onClose}>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Nama Mapel</label><input type="text" value={form.name} onChange={(e) => setForm({...form, name: e.target.value})} className="w-full border border-gray-300 p-2 rounded-lg" /></div>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Warna Label</label><select value={form.color} onChange={(e) => setForm({...form, color: e.target.value})} className="w-full border border-gray-300 p-2 rounded-lg"><option value="bg-blue-500">Biru</option><option value="bg-purple-500">Ungu</option><option value="bg-green-500">Hijau</option><option value="bg-orange-500">Oranye</option><option value="bg-red-500">Merah</option><option value="bg-pink-500">Pink</option><option value="bg-gray-500">Abu-abu</option></select></div>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Target (menit)</label><input type="number" value={form.target} onChange={(e) => setForm({...form, target: e.target.value})} className="w-full border border-gray-300 p-2 rounded-lg" /></div>
          <button onClick={handleSubmit} className="w-full bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg font-bold transition-colors">Simpan Mata Pelajaran</button>
        </Modal>
      );
    };

    const EditSubjectModal = ({ onClose, onSave, subjectData, notify }) => {
      const [form, setForm] = useState({ ...subjectData });
      const handleSubmit = () => { if (!form.name) { notify('Nama mata pelajaran harus diisi!'); return; } onSave(form); };
      return (
        <Modal title="Edit Mata Pelajaran" onClose={onClose}>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Nama Mapel</label><input type="text" value={form.name} onChange={(e) => setForm({...form, name: e.target.value})} className="w-full border border-gray-300 p-2 rounded-lg" /></div>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Warna Label</label><select value={form.color} onChange={(e) => setForm({...form, color: e.target.value})} className="w-full border border-gray-300 p-2 rounded-lg"><option value="bg-blue-500">Biru</option><option value="bg-purple-500">Ungu</option><option value="bg-green-500">Hijau</option><option value="bg-orange-500">Oranye</option><option value="bg-red-500">Merah</option><option value="bg-pink-500">Pink</option><option value="bg-gray-500">Abu-abu</option></select></div>
          <div><label className="block text-sm font-semibold mb-1 text-gray-700">Target (menit)</label><input type="number" value={form.target} onChange={(e) => setForm({...form, target: e.target.value})} className="w-full border border-gray-300 p-2 rounded-lg" /></div>
          <button onClick={handleSubmit} className="w-full bg-yellow-600 hover:bg-yellow-700 text-white p-3 rounded-lg font-bold transition-colors">Update Perubahan</button>
        </Modal>
      );
    };

    // --- MAIN APP ---
    const StudyPlannerApp = () => {
      const [isLoggedIn, setIsLoggedIn] = useState(false);
      const [currentUser, setCurrentUser] = useState(null);
      const [authView, setAuthView] = useState('login');
      const [loginEmail, setLoginEmail] = useState('');
      const [loginPassword, setLoginPassword] = useState('');
      const [signupName, setSignupName] = useState('');
      const [signupEmail, setSignupEmail] = useState('');
      const [signupPassword, setSignupPassword] = useState('');
      const [signupConfirm, setSignupConfirm] = useState('');

      const [activeTab, setActiveTab] = useState('dashboard');
      const [subjects, setSubjects] = useState([]);
      const [totalPoints, setTotalPoints] = useState(0);
      const [currentStreak, setCurrentStreak] = useState(0);
      const [schedule, setSchedule] = useState([]);
      const [flashcards, setFlashcards] = useState([]);
      const [todos, setTodos] = useState([]);
      const [weeklyStats, setWeeklyStats] = useState([0, 0, 0, 0, 0, 0, 0]); 

      const [pomodoroMinutes, setPomodoroMinutes] = useState(25);
      const [pomodoroSeconds, setPomodoroSeconds] = useState(0);
      const [isPomodoroActive, setIsPomodoroActive] = useState(false);
      const [pomodoroSubjectId, setPomodoroSubjectId] = useState('');
      
      const [showAddSchedule, setShowAddSchedule] = useState(false);
      const [showAddFlashcard, setShowAddFlashcard] = useState(false);
      const [showAddSubject, setShowAddSubject] = useState(false);
      
      // EDIT STATES
      const [editingSubject, setEditingSubject] = useState(null);
      const [editingSchedule, setEditingSchedule] = useState(null);
      const [editingFlashcard, setEditingFlashcard] = useState(null);
      const [editingTodo, setEditingTodo] = useState(null);

      const [flippedCard, setFlippedCard] = useState(null);
      const [flashcardFilter, setFlashcardFilter] = useState('Semua');

      const [notifyState, setNotifyState] = useState({ isOpen: false, message: '' });
      const [confirmState, setConfirmState] = useState({ isOpen: false, message: '', confirmLabel: '', confirmColor: '', onConfirm: null });

      const showNotify = (msg) => setNotifyState({ isOpen: true, message: msg });
      const closeNotify = () => setNotifyState({ ...notifyState, isOpen: false });
      
      const showConfirm = (msg, action, label='Hapus', color='bg-red-500 hover:bg-red-600') => {
        setConfirmState({ 
          isOpen: true, 
          message: msg, 
          confirmLabel: label,
          confirmColor: color,
          onConfirm: () => { action(); setConfirmState({ ...confirmState, isOpen: false, onConfirm: null }); }
        });
      };
      const closeConfirm = () => setConfirmState({ ...confirmState, isOpen: false, onConfirm: null });

      const getBadges = () => [
        { name: '7 Hari Beruntun', icon: 'ðŸ”¥', earned: currentStreak >= 7 },
        { name: 'Pomodoro Master', icon: 'ðŸ…', earned: totalPoints >= 500 },
        { name: 'Rajin Belajar', icon: 'ðŸŒ…', earned: schedule.length >= 5 },
        { name: '1000 Poin', icon: 'â­', earned: totalPoints >= 1000 },
      ];

      // --- PERSISTENCE ---
      useEffect(() => {
        const session = localStorage.getItem('currentSession');
        if (session) {
          const userData = JSON.parse(session);
          setIsLoggedIn(true);
          setCurrentUser(userData);
          loadUserData(userData.email);
        }
      }, []);

      // 1. STREAK LOGIC & LOAD DATA
      const loadUserData = (email) => {
        const key = `studyData_${email}`;
        const data = localStorage.getItem(key);
        if (data) {
          const parsed = JSON.parse(data);
          setSubjects(parsed.subjects || []);
          setSchedule(parsed.schedule || []);
          setFlashcards(parsed.flashcards || []);
          setTotalPoints(parsed.totalPoints || 0);
          setTodos(parsed.todos || []);
          setWeeklyStats(parsed.weeklyStats || [0, 0, 0, 0, 0, 0, 0]);

          // Streak Check
          const lastDateStr = parsed.lastLoginDate;
          const todayStr = new Date().toDateString();
          let newStreak = parsed.currentStreak || 0;

          if (lastDateStr !== todayStr) {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            if (lastDateStr === yesterday.toDateString()) {
              newStreak += 1;
            } else {
              newStreak = 1; // Reset if missed more than 1 day
            }
          }
          // If first login ever, it will set to 1.
          if (newStreak === 0) newStreak = 1;

          setCurrentStreak(newStreak);
          
          // IMPORTANT: Update storage immediately with new date
          const updatedData = { ...parsed, currentStreak: newStreak, lastLoginDate: todayStr };
          localStorage.setItem(key, JSON.stringify(updatedData));

        } else {
          resetStateToEmpty();
        }
      };

      const resetStateToEmpty = () => {
        setSubjects([]);
        setSchedule([]);
        setFlashcards([]);
        setTotalPoints(0);
        setCurrentStreak(1); // New user starts with 1
        setTodos([]);
        setWeeklyStats([0, 0, 0, 0, 0, 0, 0]);
      };

      const saveUserData = () => {
        if (currentUser && isLoggedIn) {
          const key = `studyData_${currentUser.email}`;
          // Save with today's date so next load checks against this
          const data = { 
            subjects, schedule, flashcards, totalPoints, currentStreak, todos, weeklyStats,
            lastLoginDate: new Date().toDateString()
          };
          localStorage.setItem(key, JSON.stringify(data));
        }
      };

      useEffect(() => {
        if (isLoggedIn && currentUser) { saveUserData(); }
      }, [subjects, schedule, flashcards, totalPoints, currentStreak, todos, weeklyStats]);

      // --- AUTH HANDLERS ---
      // 2. EMAIL VALIDATION & 3. PASSWORD STRENGTH
      const isValidEmail = (email) => {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      };

      const validatePassword = (password) => {
        const minLength = 8;
        const hasUpperCase = /[A-Z]/.test(password);
        const hasLowerCase = /[a-z]/.test(password);
        const hasNumbers = /\d/.test(password);
        const hasNonalphas = /\W/.test(password);
        return password.length >= minLength && hasUpperCase && hasLowerCase && hasNumbers && hasNonalphas;
      };

      const handleLogin = () => {
        if (!isValidEmail(loginEmail)) { showNotify('Format email tidak valid! Gunakan format seperti nama@contoh.com'); return; }
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        const user = users.find(u => u.email.toLowerCase().trim() === loginEmail.toLowerCase().trim());
        if (!user) { showNotify('Akun dengan email ini belum terdaftar. Silakan daftar terlebih dahulu.'); return; }
        if (user.password !== loginPassword.trim()) { showNotify('Password salah!'); return; }
        setIsLoggedIn(true); setCurrentUser(user);
        localStorage.setItem('currentSession', JSON.stringify(user));
        loadUserData(user.email);
        setLoginEmail(''); setLoginPassword('');
      };

      const handleSignup = () => {
        if (!signupName.trim() || !signupEmail.trim() || !signupPassword.trim()) { showNotify('Semua field harus diisi!'); return; }
        if (!isValidEmail(signupEmail)) { showNotify('Format email tidak valid! Gunakan format seperti nama@contoh.com'); return; }
        // NEW: Strict Password Check
        if (!validatePassword(signupPassword)) { 
          showNotify('Password harus minimal 8 karakter, mengandung huruf besar, huruf kecil, angka, dan simbol!'); 
          return; 
        }
        if (signupPassword.trim() !== signupConfirm.trim()) { showNotify('Password dan konfirmasi tidak cocok!'); return; }
        
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        if (users.find(u => u.email.toLowerCase().trim() === signupEmail.toLowerCase().trim())) { showNotify('Email ini sudah terdaftar! Silakan login.'); return; }
        const newUser = { name: signupName.trim(), email: signupEmail.toLowerCase().trim(), password: signupPassword.trim() };
        users.push(newUser);
        localStorage.setItem('users', JSON.stringify(users));
        // Initialize new user data
        localStorage.setItem(`studyData_${newUser.email}`, JSON.stringify({ 
          subjects: [], schedule: [], flashcards: [], totalPoints: 0, 
          currentStreak: 1, todos: [], weeklyStats: [0,0,0,0,0,0,0],
          lastLoginDate: new Date().toDateString()
        }));
        showNotify('âœ… Akun berhasil dibuat! Silakan login.');
        setAuthView('login');
        setSignupName(''); setSignupEmail(''); setSignupPassword(''); setSignupConfirm('');
      };

      // FIXED: Logout now shows "Keluar" button with blue color
      const handleLogout = () => {
        showConfirm('Yakin ingin keluar dari akun?', () => {
          setIsLoggedIn(false); setCurrentUser(null);
          localStorage.removeItem('currentSession');
          resetStateToEmpty();
          setLoginEmail(''); setLoginPassword('');
        }, 'Keluar', 'bg-blue-600 hover:bg-blue-700');
      };

      // --- LOGIC STATS ---
      const updateDailyStats = (minutesToAdd) => {
        const today = new Date().getDay();
        const arrayIndex = today === 0 ? 6 : today - 1;
        setWeeklyStats(prev => {
          const newStats = [...prev];
          newStats[arrayIndex] = Math.max(0, newStats[arrayIndex] + minutesToAdd);
          return newStats;
        });
      };

      const deductStats = (minutesToDeduct) => {
        setWeeklyStats(prev => {
          let remaining = minutesToDeduct;
          const newStats = [...prev];
          const todayJS = new Date().getDay();
          let currentIndex = todayJS === 0 ? 6 : todayJS - 1; 
          for (let i = 0; i < 7; i++) {
            if (remaining <= 0) break;
            if (newStats[currentIndex] > 0) {
              const deductFromDay = Math.min(newStats[currentIndex], remaining);
              newStats[currentIndex] -= deductFromDay;
              remaining -= deductFromDay;
            }
            currentIndex--;
            if (currentIndex < 0) currentIndex = 6;
          }
          return newStats;
        });
      };

      // --- POMODORO ---
      useEffect(() => {
        let interval = null;
        if (isPomodoroActive) {
          interval = setInterval(() => {
            if (pomodoroSeconds > 0) { 
              setPomodoroSeconds(pomodoroSeconds - 1); 
            } else if (pomodoroMinutes > 0) { 
              setPomodoroMinutes(pomodoroMinutes - 1); 
              setPomodoroSeconds(59); 
            } else {
              setIsPomodoroActive(false);
              setTotalPoints(prev => prev + 25);
              const minutesEarned = 25;
              updateDailyStats(minutesEarned);
              if (pomodoroSubjectId) {
                const subjectIdInt = parseInt(pomodoroSubjectId);
                const subject = subjects.find(s => s.id === subjectIdInt);
                if (subject) {
                  setSubjects(prevSubjects => prevSubjects.map(s => {
                    if (s.id === subjectIdInt) return { 
                      ...s, 
                      studyTime: s.studyTime + minutesEarned,
                      accumulatedPoints: (s.accumulatedPoints || 0) + 25 
                    };
                    return s;
                  }));
                  showNotify(`Sesi Selesai! +25 menit ditambahkan ke ${subject.name} ðŸŽ‰`);
                } else {
                  showNotify('Sesi Pomodoro selesai! +25 poin.');
                }
              } else {
                showNotify('Sesi Pomodoro selesai! +25 poin.');
              }
              setPomodoroMinutes(25); setPomodoroSeconds(0); 
            }
          }, 1000);
        }
        return () => clearInterval(interval);
      }, [isPomodoroActive, pomodoroMinutes, pomodoroSeconds, pomodoroSubjectId, subjects]);

      // --- HANDLERS ---
      
      const handleAddTime = (id) => {
        setSubjects(subjects.map(s => s.id === id ? {
          ...s, 
          studyTime: s.studyTime + 30,
          accumulatedPoints: (s.accumulatedPoints || 0) + 10 
        } : s));
        updateDailyStats(30); 
        setTotalPoints(prev => prev + 10);
      };

      const handleUpdateSubject = (updatedData) => {
        const oldSubject = subjects.find(s => s.id === updatedData.id);
        if (!oldSubject) return;
        const newName = updatedData.name;
        const oldName = oldSubject.name;
        setSubjects(subjects.map(s => s.id === updatedData.id ? { ...s, ...updatedData } : s));
        if (newName !== oldName) {
          setSchedule(prev => prev.map(item => item.subject === oldName ? { ...item, subject: newName } : item));
          setFlashcards(prev => prev.map(item => item.subject === oldName ? { ...item, subject: newName } : item));
        }
        setEditingSubject(null);
        showNotify('Mata pelajaran berhasil diperbarui!');
      };

      const handleDeleteSubject = (id) => {
        showConfirm('Hapus mata pelajaran ini? Progress dan poin akan berkurang.', () => {
          const subject = subjects.find(s => s.id === id);
          if (subject) {
            const pointsToDeduct = subject.accumulatedPoints !== undefined 
              ? subject.accumulatedPoints 
              : Math.floor(subject.studyTime / 30) * 10;
            
            // FIXED: Gunakan variabel yang benar 'pointsToDeduct'
            const totalDeduction = pointsToDeduct + 10;
              
            setTotalPoints(prev => Math.max(0, prev - totalDeduction));
            if (subject.studyTime > 0) { deductStats(subject.studyTime); }
            setSubjects(subjects.filter(s => s.id !== id));
          }
        });
      };

      const handleAddSchedule = (data) => {
        setSchedule([...schedule, { id: Date.now(), ...data }]);
        setShowAddSchedule(false);
        setTotalPoints(prev => prev + 5);
      };

      // NEW: Edit Schedule Handler
      const handleUpdateSchedule = (updatedData) => {
        setSchedule(schedule.map(s => s.id === updatedData.id ? updatedData : s));
        setEditingSchedule(null);
        showNotify('Jadwal berhasil diperbarui!');
      };

      const handleDeleteSchedule = (id) => {
        showConfirm('Hapus jadwal ini? Poin akan ditarik (-5).', () => {
          setSchedule(schedule.filter(s => s.id !== id));
          setTotalPoints(prev => Math.max(0, prev - 5));
        });
      };

      const handleAddFlashcard = (data) => {
        setFlashcards([...flashcards, { id: Date.now(), ...data, reviewed: false }]);
        setShowAddFlashcard(false);
        setTotalPoints(prev => prev + 5);
      };

      // NEW: Edit Flashcard Handler
      const handleUpdateFlashcard = (updatedData) => {
        setFlashcards(flashcards.map(f => f.id === updatedData.id ? updatedData : f));
        setEditingFlashcard(null);
        showNotify('Flashcard berhasil diperbarui!');
      };

      const handleDeleteFlashcard = (id) => {
        showConfirm('Hapus flashcard ini? Poin akan ditarik.', () => {
          const card = flashcards.find(f => f.id === id);
          let deduction = 5; 
          if (card && card.reviewed) { deduction += 10; }
          setTotalPoints(prev => Math.max(0, prev - deduction));
          setFlashcards(flashcards.filter(f => f.id !== id));
        });
      };

      const handleAddSubject = (data) => {
        setSubjects([...subjects, { 
          id: Date.now(), 
          name: data.name, 
          color: data.color, 
          studyTime: 0, 
          target: parseInt(data.target),
          accumulatedPoints: 0 
        }]);
        setTotalPoints(prev => prev + 10);
        setShowAddSubject(false);
      };

      const handleAddTodo = (text, date) => {
        const item = { id: Date.now(), text, deadline: date, completed: false };
        setTodos([...todos, item]);
        setTotalPoints(prev => prev + 5);
      };

      // NEW: Edit Todo Handler
      const handleUpdateTodo = (updatedData) => {
        setTodos(todos.map(t => t.id === updatedData.id ? updatedData : t));
        setEditingTodo(null);
        showNotify('Tugas berhasil diperbarui!');
      };

      const handleToggleTodo = (id) => {
        setTodos(todos.map(t => {
          if (t.id === id) {
            const isNowCompleted = !t.completed;
            if (isNowCompleted) { setTotalPoints(prev => prev + 15); } else { setTotalPoints(prev => Math.max(0, prev - 15)); }
            return { ...t, completed: isNowCompleted };
          }
          return t;
        }));
      };

      const handleDeleteTodo = (id) => {
        showConfirm('Hapus tugas ini? Poin akan ditarik.', () => {
          const todo = todos.find(t => t.id === id);
          let deduction = 5; 
          if (todo && todo.completed) { deduction += 15; }
          setTotalPoints(prev => Math.max(0, prev - deduction));
          setTodos(todos.filter(t => t.id !== id));
        });
      };

      // --- RESPONSIVE GRIDS ---
      const DashboardView = () => (
        <div className="space-y-6">
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div className="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white"><div className="flex items-center justify-between"><div><p className="text-blue-100 text-sm">Total Poin</p><p className="text-3xl font-bold mt-1">{totalPoints}</p></div><Award /></div></div>
            <div className="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-6 text-white"><div className="flex items-center justify-between"><div><p className="text-orange-100 text-sm">Streak Hari</p><p className="text-3xl font-bold mt-1">{currentStreak} ðŸ”¥</p></div><Zap /></div></div>
            <div className="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-6 text-white"><div className="flex items-center justify-between"><div><p className="text-green-100 text-sm">Total Waktu</p><p className="text-3xl font-bold mt-1">{subjects.reduce((acc, s) => acc + s.studyTime, 0)}m</p></div><Clock /></div></div>
            <div className="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-6 text-white"><div className="flex items-center justify-between"><div><p className="text-purple-100 text-sm">Progress Total</p><p className="text-3xl font-bold mt-1">{subjects.length > 0 ? Math.round((subjects.reduce((acc, s) => acc + s.studyTime, 0) / subjects.reduce((acc, s) => acc + s.target, 0)) * 100) : 0}%</p></div><TrendingUp /></div></div>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div className="bg-white rounded-xl shadow-lg p-6">
              <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"><BarChart3 /> Statistik Mingguan (Menit)</h3>
              <div className="flex items-end justify-between h-48 pt-4 gap-2">
                {['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min'].map((day, idx) => {
                   const val = weeklyStats[idx];
                   const maxVal = Math.max(...weeklyStats, 60); 
                   const heightPercent = Math.min((val / maxVal) * 100, 100);
                   return (
                     <div key={idx} className="flex flex-col items-center w-full group">
                       <div className="relative w-full flex items-end justify-center h-40 bg-gray-50 rounded-t-lg">
                          <div className="w-4/5 bg-blue-500 rounded-t-lg transition-all duration-500 group-hover:bg-blue-600 relative" style={{ height: `${heightPercent}%` }}>
                            <span className="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-10">{val} m</span>
                          </div>
                       </div>
                       <span className="text-xs font-semibold text-gray-500 mt-2">{day}</span>
                     </div>
                   )
                })}
              </div>
            </div>

            <div className="bg-white rounded-xl shadow-lg p-6 flex flex-col h-full">
              <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"><ListTodo /> Tugas & Deadline</h3>
              <TodoInput onAdd={handleAddTodo} notify={showNotify} />
              
              <div className="flex-1 overflow-y-auto custom-scroll pr-1 max-h-60">
                {todos.length === 0 ? (
                  <div className="text-center text-gray-400 py-8 text-sm">Tidak ada tugas aktif.</div>
                ) : (
                  <ul className="space-y-2">
                    {todos.map(todo => (
                      <li key={todo.id} className={`flex items-start justify-between p-3 rounded-lg border transition-all ${todo.completed ? 'bg-gray-50 border-gray-100 opacity-70' : 'bg-white border-gray-200 hover:border-blue-300 shadow-sm'}`}>
                        <div className="flex items-start gap-3">
                          <button onClick={() => handleToggleTodo(todo.id)} className={`mt-1 w-5 h-5 rounded border flex items-center justify-center transition-colors ${todo.completed ? 'bg-green-500 border-green-500 text-white' : 'border-gray-300 hover:border-blue-500'}`}>
                            {todo.completed && <Check className="w-3 h-3" />}
                          </button>
                          <div>
                            <p className={`text-sm font-medium ${todo.completed ? 'text-gray-500 line-through' : 'text-gray-800'}`}>{todo.text}</p>
                            {todo.deadline && <p className="text-xs text-red-500 mt-1 flex items-center gap-1"><Calendar className="w-3 h-3"/> {todo.deadline}</p>}
                          </div>
                        </div>
                        <div className="flex items-center gap-2">
                          <button onClick={() => setEditingTodo(todo)} className="text-gray-400 hover:text-blue-500 transition-colors"><Edit /></button>
                          <button onClick={() => handleDeleteTodo(todo.id)} className="text-gray-400 hover:text-red-500 transition-colors"><X className="w-4 h-4"/></button>
                        </div>
                      </li>
                    ))}
                  </ul>
                )}
              </div>
            </div>
          </div>

          <div className="bg-white rounded-xl shadow-lg p-6">
            <div className="flex justify-between items-center mb-4"><h3 className="text-xl font-bold text-gray-800 flex items-center gap-2"><BarChart3 /> Progress Belajar</h3><button onClick={() => setShowAddSubject(true)} className="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm flex items-center gap-1 transition-colors"><Plus /> Tambah Mapel</button></div>
            {subjects.length === 0 ? (<div className="flex flex-col items-center justify-center p-8 text-gray-400 border-2 border-dashed border-gray-200 rounded-xl"><Book className="w-12 h-12 mb-2"/><p>Belum ada mata pelajaran.</p></div>) : (
              <div className="space-y-4">
                {subjects.map(subject => (
                  <div key={subject.id} className="group bg-gray-50 p-3 rounded-lg border border-gray-100 hover:border-blue-100 transition-all">
                    <div className="flex justify-between items-center mb-2">
                      <div className="flex items-center gap-3">
                        <span className="font-semibold text-gray-700">{subject.name}</span>
                        <button onClick={() => setEditingSubject(subject)} className="text-gray-400 hover:text-blue-500 transition-colors p-1" title="Edit Mapel"><Edit /></button>
                        <button onClick={() => handleAddTime(subject.id)} className="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-lg text-xs font-semibold transition-all shadow">+30m</button>
                      </div>
                      <div className="flex items-center gap-2">
                        <span className="text-sm text-gray-500">{subject.studyTime}/{subject.target}m</span>
                        <button onClick={() => handleDeleteSubject(subject.id)} className="bg-white text-gray-400 hover:text-red-500 border hover:border-red-200 p-1.5 rounded-lg transition-all shadow-sm"><Trash /></button>
                      </div>
                    </div>
                    <div className="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                      <div className={`${subject.color} h-full rounded-full transition-all duration-500`} style={{ width: `${Math.min((subject.studyTime / subject.target) * 100, 100)}%` }} />
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
          <div className="bg-white rounded-xl shadow-lg p-6"><h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"><Award /> Badge & Pencapaian</h3><div className="grid grid-cols-2 md:grid-cols-4 gap-4">{getBadges().map((badge, idx) => (<div key={idx} className={`p-4 rounded-lg text-center transition-all transform ${badge.earned ? 'bg-gradient-to-br from-yellow-100 to-yellow-200 border-2 border-yellow-400 shadow-lg' : 'bg-gray-50 opacity-50 grayscale'}`}><div className="text-4xl mb-2">{badge.icon}</div><p className="text-sm font-semibold text-gray-700">{badge.name}</p>{!badge.earned && <p className="text-xs text-gray-400 mt-1">Belum diraih</p>}</div>))}</div></div>
        </div>
      );

      const ScheduleView = () => (
        <div className="space-y-4">
          <div className="flex justify-between items-center"><h3 className="text-2xl font-bold text-gray-800 flex items-center gap-2"><Calendar /> Jadwal Belajar</h3><button onClick={() => setShowAddSchedule(true)} className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors"><Plus /> Tambah Jadwal</button></div>
          <div className="bg-white rounded-xl shadow-lg overflow-hidden">
            {schedule.length === 0 ? (<div className="p-8 text-center text-gray-500">Jadwal masih kosong.</div>) : (
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead className="bg-gray-50"><tr><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Hari</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Waktu</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Mapel</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Durasi</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tipe</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Aksi</th></tr></thead>
                  <tbody className="divide-y divide-gray-200">
                    {schedule.map(item => (
                      <tr key={item.id} className="hover:bg-gray-50 transition-colors">
                        <td className="px-6 py-4 text-sm font-medium text-gray-900">{item.day}</td>
                        <td className="px-6 py-4 text-sm text-gray-600">{item.time}</td>
                        <td className="px-6 py-4 text-sm text-gray-900">{item.subject}</td>
                        <td className="px-6 py-4 text-sm text-gray-600">{item.duration}</td>
                        <td className="px-6 py-4"><span className={`px-3 py-1 rounded-full text-xs font-semibold ${item.type === 'exam' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`}>{item.type === 'exam' ? 'Ujian' : 'Belajar'}</span></td>
                        <td className="px-6 py-4 flex gap-2">
                          <button onClick={() => setEditingSchedule(item)} className="text-blue-500 hover:text-blue-700 p-2 hover:bg-blue-50 rounded-lg transition-colors"><Edit /></button>
                          <button onClick={() => handleDeleteSchedule(item.id)} className="text-red-500 hover:text-red-700 p-2 hover:bg-red-50 rounded-lg transition-colors"><Trash /></button>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </div>
        </div>
      );

      const FlashcardsView = () => {
        const uniqueSubjects = useMemo(() => {
          const subjectsFromCards = flashcards.map(f => f.subject);
          const subjectsFromList = subjects.map(s => s.name);
          return ['Semua', ...new Set([...subjectsFromCards, ...subjectsFromList])].sort();
        }, [flashcards, subjects]);
        const filteredFlashcards = flashcardFilter === 'Semua' ? flashcards : flashcards.filter(f => f.subject === flashcardFilter);

        const getCardStyle = (subjectName) => {
          const subject = subjects.find(s => s.name === subjectName);
          const colorClass = subject ? subject.color : 'bg-blue-500';
          const styles = {
            'bg-blue-500':   { gradient: 'from-blue-500 to-blue-700',   border: 'border-blue-900',   text: 'text-blue-200' },
            'bg-purple-500': { gradient: 'from-purple-500 to-purple-700', border: 'border-purple-900', text: 'text-purple-200' },
            'bg-green-500':  { gradient: 'from-green-500 to-green-700',  border: 'border-green-900',  text: 'text-green-200' },
            'bg-orange-500': { gradient: 'from-orange-500 to-orange-700', border: 'border-orange-900', text: 'text-orange-200' },
            'bg-red-500':    { gradient: 'from-red-500 to-red-700',     border: 'border-red-900',    text: 'text-red-200' },
            'bg-pink-500':   { gradient: 'from-pink-500 to-pink-700',    border: 'border-pink-900',   text: 'text-pink-200' },
            'bg-gray-500':   { gradient: 'from-gray-500 to-gray-700',    border: 'border-gray-900',   text: 'text-gray-200' },
          };
          return styles[colorClass] || styles['bg-blue-500'];
        };

        return (
          <div className="space-y-4">
            <div className="flex flex-col md:flex-row justify-between items-center gap-4">
              <h3 className="text-2xl font-bold text-gray-800 flex items-center gap-2"><Book /> Flashcard Digital</h3>
              <div className="flex items-center gap-2 w-full md:w-auto">
                <div className="relative">
                  <select value={flashcardFilter} onChange={(e) => setFlashcardFilter(e.target.value)} className="appearance-none bg-white border border-gray-300 text-gray-700 py-2 px-4 pr-8 rounded-lg leading-tight focus:outline-none focus:border-blue-500">
                    {uniqueSubjects.map(sub => <option key={sub} value={sub}>{sub}</option>)}
                  </select>
                  <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700"><Filter /></div>
                </div>
                <button onClick={() => setShowAddFlashcard(true)} className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors whitespace-nowrap"><Plus /> Buat Baru</button>
              </div>
            </div>
            {flashcards.length === 0 ? (<div className="p-8 text-center text-gray-500 bg-white rounded-xl shadow">Belum ada flashcard.</div>) : filteredFlashcards.length === 0 ? (<div className="text-center p-8 text-gray-500">Tidak ada flashcard kategori ini.</div>) : (
              <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
                {filteredFlashcards.map(card => {
                  const cardStyle = getCardStyle(card.subject);
                  return (
                    <div key={card.id} className={`flip-card relative h-64 cursor-pointer ${flippedCard === card.id ? 'flipped' : ''}`} onClick={() => setFlippedCard(flippedCard === card.id ? null : card.id)}>
                      <div className="flip-card-inner relative w-full h-full">
                        <div className={`flip-card-front absolute w-full h-full bg-gradient-to-br ${cardStyle.gradient} rounded-xl p-6 text-white shadow-xl flex flex-col justify-between border-b-4 ${cardStyle.border}`}>
                          <div>
                            <div className="flex justify-between items-start mb-3">
                              <span className="bg-black/20 px-2 py-1 rounded text-xs font-semibold text-white backdrop-blur-sm">{card.subject}</span>
                              <div className="flex gap-1">
                                <button 
                                  onClick={(e) => { e.stopPropagation(); setEditingFlashcard(card); }} 
                                  className="action-btn-front bg-black/20 hover:bg-blue-500/80 text-white p-2 rounded-full transition-all backdrop-blur-sm"
                                  title="Edit Kartu"
                                >
                                  <Edit />
                                </button>
                                <button 
                                  onClick={(e) => { e.stopPropagation(); handleDeleteFlashcard(card.id); }} 
                                  className="action-btn-front bg-black/20 hover:bg-red-500/80 text-white p-2 rounded-full transition-all backdrop-blur-sm"
                                  title="Hapus Kartu"
                                >
                                  <Trash />
                                </button>
                              </div>
                            </div>
                            <div className="text-xl font-bold mt-2 text-center drop-shadow-md">{card.front}</div>
                          </div>
                          <div className={`text-center ${cardStyle.text} text-xs uppercase tracking-wide font-medium`}>Ketuk untuk jawaban</div>
                        </div>
                        <div className="flip-card-back absolute w-full h-full bg-gradient-to-br from-emerald-500 to-emerald-700 rounded-xl p-6 text-white shadow-xl flex flex-col justify-between border-b-4 border-emerald-900">
                          <div>
                            <div className="text-xs font-semibold text-emerald-100 mb-3 text-center uppercase tracking-wider">Jawaban</div>
                            <div className="text-2xl font-bold text-center drop-shadow-md">{card.back}</div>
                          </div>
                          <div className="flex gap-2 justify-center">
                            <button onClick={(e) => { e.stopPropagation(); setFlashcards(flashcards.map(c => c.id === card.id ? {...c, reviewed: true} : c)); setTotalPoints(prev => prev + 10); }} className="bg-white text-emerald-700 px-6 py-2 rounded-full font-bold hover:bg-emerald-50 transition-colors text-sm flex items-center gap-1 shadow-lg action-btn-front">
                              <Check /> Paham
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  );
                })}
              </div>
            )}
          </div>
        );
      };

      const TechniqueView = () => (
        <div className="space-y-6">
          <div className="bg-white rounded-xl shadow-lg p-8">
            <h3 className="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2"><Timer /> Pomodoro Timer</h3>
            
            {/* NEW: Dropdown Mata Pelajaran untuk Pomodoro */}
            <div className="mb-8 w-full max-w-md mx-auto">
                <label className="block text-sm font-semibold text-gray-600 mb-2 text-center">Fokus Belajar untuk Mapel:</label>
                <select 
                  value={pomodoroSubjectId} 
                  onChange={(e) => setPomodoroSubjectId(e.target.value)}
                  className="w-full p-3 border border-gray-300 rounded-xl text-center font-medium bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                  disabled={isPomodoroActive} // Disable saat timer jalan
                >
                  <option value="">-- Umum (Tidak spesifik) --</option>
                  {subjects.map(s => (
                    <option key={s.id} value={s.id}>{s.name}</option>
                  ))}
                </select>
                {pomodoroSubjectId && (
                   <p className="text-xs text-green-600 text-center mt-2 font-medium">âœ¨ Progress +25 menit akan ditambahkan ke mapel ini setelah timer selesai.</p>
                )}
            </div>

            <div className="flex flex-col items-center">
              <div className="text-7xl font-mono font-bold text-gray-800 mb-6 tracking-wider">{String(pomodoroMinutes).padStart(2, '0')}:{String(pomodoroSeconds).padStart(2, '0')}</div>
              <div className="flex gap-4">
                <button onClick={() => setIsPomodoroActive(!isPomodoroActive)} className={`${isPomodoroActive ? 'bg-amber-500 hover:bg-amber-600' : 'bg-green-600 hover:bg-green-700'} text-white px-8 py-3 rounded-xl font-bold flex items-center gap-2 transition-colors shadow-lg`}>{isPomodoroActive ? <><Pause /> Jeda</> : <><Play /> Mulai</>}</button>
                <button onClick={() => { setIsPomodoroActive(false); setPomodoroMinutes(25); setPomodoroSeconds(0); }} className="bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-xl font-bold transition-colors shadow-lg">Reset</button>
              </div>
            </div>
          </div>
        </div>
      );

      if (!isLoggedIn) {
        return (
          <div className="min-h-screen professional-bg flex items-center justify-center p-4">
            <div className="bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl p-8 max-w-md w-full border border-white/20">
              <div className="text-center mb-8">
                <div className="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                  <div className="text-3xl">ðŸ“š</div>
                </div>
                <h1 className="text-3xl font-bold text-gray-900 mb-2 tracking-tight">Studyfy</h1>
                <p className="text-gray-500 font-medium">Platform Manajemen Belajar</p>
              </div>

              {authView === 'login' ? (
                <div className="space-y-5">
                  <h2 className="text-xl font-bold text-gray-800 border-l-4 border-blue-500 pl-3">Masuk Akun</h2>
                  <div><label className="block text-xs font-bold text-gray-500 uppercase mb-1">Email</label><input type="email" value={loginEmail} onChange={(e) => setLoginEmail(e.target.value)} placeholder="nama@email.com" className="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all outline-none" /></div>
                  <div><label className="block text-xs font-bold text-gray-500 uppercase mb-1">Password</label><input type="password" value={loginPassword} onChange={(e) => setLoginPassword(e.target.value)} placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" className="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all outline-none" /></div>
                  <button onClick={handleLogin} className="w-full bg-blue-600 hover:bg-blue-700 text-white py-3.5 rounded-lg font-bold transition-all shadow-lg shadow-blue-500/30 transform hover:-translate-y-0.5">Masuk Sekarang</button>
                  <div className="text-center pt-2"><button onClick={() => setAuthView('signup')} className="text-blue-600 hover:text-blue-800 font-semibold text-sm">Belum punya akun? Daftar gratis</button></div>
                </div>
              ) : (
                <div className="space-y-5">
                  <h2 className="text-xl font-bold text-gray-800 border-l-4 border-green-500 pl-3">Daftar Baru</h2>
                  <div><label className="block text-xs font-bold text-gray-500 uppercase mb-1">Nama Lengkap</label><input type="text" value={signupName} onChange={(e) => setSignupName(e.target.value)} className="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 focus:ring-2 focus:ring-green-500 outline-none" /></div>
                  <div><label className="block text-xs font-bold text-gray-500 uppercase mb-1">Email</label><input type="email" value={signupEmail} onChange={(e) => setSignupEmail(e.target.value)} className="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 focus:ring-2 focus:ring-green-500 outline-none" /></div>
                  
                  {/* Password Criteria Info - One Line */}
                  <div className="bg-blue-50 border border-blue-100 rounded-lg p-2.5 text-xs text-blue-800 flex items-center gap-2">
                    <div className="shrink-0 transform scale-75"><Info /></div>
                    <span>Password wajib: Min 8 karakter, Huruf Besar & Kecil, Angka & Simbol.</span>
                  </div>

                  <div className="grid grid-cols-2 gap-3">
                    <div><label className="block text-xs font-bold text-gray-500 uppercase mb-1">Password</label><input type="password" value={signupPassword} onChange={(e) => setSignupPassword(e.target.value)} className="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 focus:ring-2 focus:ring-green-500 outline-none" /></div>
                    <div><label className="block text-xs font-bold text-gray-500 uppercase mb-1">Konfirmasi</label><input type="password" value={signupConfirm} onChange={(e) => setSignupConfirm(e.target.value)} className="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 focus:ring-2 focus:ring-green-500 outline-none" /></div>
                  </div>
                  <button onClick={handleSignup} className="w-full bg-green-600 hover:bg-green-700 text-white py-3.5 rounded-lg font-bold transition-all shadow-lg shadow-green-500/30 transform hover:-translate-y-0.5">Buat Akun</button>
                  <div className="text-center pt-2"><button onClick={() => setAuthView('login')} className="text-blue-600 hover:text-blue-800 font-semibold text-sm">Sudah punya akun? Masuk</button></div>
                </div>
              )}
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-slate-50 p-4 md:p-8 font-sans text-gray-900">
          <div className="max-w-7xl mx-auto">
            {/* Header */}
            <div className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-8 flex flex-col md:flex-row justify-between items-center gap-4">
              <div className="flex items-center gap-4">
                <div className="bg-blue-600 text-white p-3 rounded-xl shadow-lg shadow-blue-500/30">
                  <span className="text-2xl">ðŸ“š</span>
                </div>
                <div>
                  <h1 className="text-2xl font-bold text-gray-900">Studyfy</h1>
                  <p className="text-gray-500 text-sm">Selamat belajar, <span className="text-blue-600 font-semibold">{currentUser?.name}</span>!</p>
                </div>
              </div>
              <button onClick={handleLogout} className="px-5 py-2.5 bg-white border border-gray-200 text-gray-600 hover:text-red-500 hover:border-red-200 rounded-xl font-medium transition-all text-sm shadow-sm hover:shadow">Keluar</button>
            </div>

            {/* Navigation */}
            <div className="bg-white rounded-2xl shadow-sm border border-gray-100 p-2 mb-8 flex flex-wrap gap-2 overflow-x-auto">
              {[{ id: 'dashboard', label: 'Dashboard', icon: TrendingUp }, { id: 'schedule', label: 'Jadwal', icon: Calendar }, { id: 'technique', label: 'Teknik Belajar', icon: Brain }, { id: 'flashcards', label: 'Flashcards', icon: Book }].map(tab => (
                <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`flex items-center gap-2 px-5 py-3 rounded-xl font-semibold transition-all text-sm whitespace-nowrap ${activeTab === tab.id ? 'bg-blue-600 text-white shadow-lg shadow-blue-500/30' : 'text-gray-500 hover:bg-gray-50 hover:text-gray-900'}`}>{React.createElement(tab.icon)} {tab.label}</button>
              ))}
            </div>

            {/* Main Content */}
            <div className="animate-slide-down">
              {activeTab === 'dashboard' && <DashboardView />}
              {activeTab === 'schedule' && <ScheduleView />}
              {activeTab === 'technique' && <TechniqueView />}
              {activeTab === 'flashcards' && <FlashcardsView />}
            </div>
          </div>
          
          {/* Modals */}
          {showAddSchedule && <AddScheduleModal onClose={() => setShowAddSchedule(false)} onSave={handleAddSchedule} subjects={subjects} notify={showNotify} />}
          {showAddFlashcard && <AddFlashcardModal onClose={() => setShowAddFlashcard(false)} onSave={handleAddFlashcard} subjects={subjects} notify={showNotify} />}
          {showAddSubject && <AddSubjectModal onClose={() => setShowAddSubject(false)} onSave={handleAddSubject} notify={showNotify} />}
          {editingSubject && <EditSubjectModal onClose={() => setEditingSubject(null)} onSave={handleUpdateSubject} subjectData={editingSubject} notify={showNotify} />}
          {editingSchedule && <EditScheduleModal onClose={() => setEditingSchedule(null)} onSave={handleUpdateSchedule} scheduleData={editingSchedule} subjects={subjects} />}
          {editingFlashcard && <EditFlashcardModal onClose={() => setEditingFlashcard(null)} onSave={handleUpdateFlashcard} cardData={editingFlashcard} subjects={subjects} />}
          {editingTodo && <EditTodoModal onClose={() => setEditingTodo(null)} onSave={handleUpdateTodo} todoData={editingTodo} />}

          {/* Global Notification & Confirmation */}
          <NotificationModal isOpen={notifyState.isOpen} message={notifyState.message} onClose={closeNotify} />
          <ConfirmationModal isOpen={confirmState.isOpen} message={confirmState.message} onConfirm={confirmState.onConfirm} onCancel={closeConfirm} confirmLabel={confirmState.confirmLabel} confirmColor={confirmState.confirmColor} />
        </div>
      );
    };

    ReactDOM.render(<StudyPlannerApp />, document.getElementById('root'));
  </script>
</body>
</html>
